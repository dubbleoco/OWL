<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Owl â€” Review</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0f13;
    --card-bg: #1a1a22;
    --card-radius: 22px;
    --text: #f5f3ef;
    --text-soft: rgba(255,255,255,0.55);
    --text-faint: rgba(255,255,255,0.2);
    --nope: #ff4458;
    --nope-soft: rgba(255,68,88,0.15);
    --like: #00d48a;
    --like-soft: rgba(0,212,138,0.15);
    --gold: #f5c842;
    --gold-soft: rgba(245,200,66,0.12);
    --idea-gradient: linear-gradient(135deg, #f5c842 0%, #f59e42 100%);
    --todo-gradient: linear-gradient(135deg, #4a90e2 0%, #6c5ce7 100%);
    --research-gradient: linear-gradient(135deg, #00d48a 0%, #00b894 100%);
    --memory-gradient: linear-gradient(135deg, #a87bdb 0%, #6c5ce7 100%);
    --urgent-gradient: linear-gradient(135deg, #ff4458 0%, #ff6b81 100%);
    --task-gradient: linear-gradient(135deg, #4a90e2 0%, #6c5ce7 100%);
    --font: 'Outfit', -apple-system, sans-serif;
    --mono: 'DM Mono', monospace;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; overflow: hidden; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font);
    -webkit-font-smoothing: antialiased;
    -webkit-tap-highlight-color: transparent;
  }
  .app {
    height: 100%;
    display: flex;
    flex-direction: column;
    padding-top: var(--safe-top);
    padding-bottom: var(--safe-bottom);
    max-width: 500px;
    margin: 0 auto;
  }
  .header {
    padding: 16px 20px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }
  .logo { display: flex; align-items: center; gap: 8px; }
  .logo-icon { font-size: 26px; filter: drop-shadow(0 2px 8px rgba(245,200,66,0.3)); }
  .logo-text {
    font-size: 22px; font-weight: 700;
    background: linear-gradient(135deg, #f5c842, #f59e42);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    letter-spacing: -0.02em;
  }
  .header-badge {
    font-family: var(--mono); font-size: 11px; font-weight: 500;
    color: var(--gold); background: var(--gold-soft);
    padding: 5px 12px; border-radius: 20px;
  }
  .matches-view {
    flex: 1; overflow-y: auto; padding: 4px 16px 120px;
    -webkit-overflow-scrolling: touch;
  }
  .section-label {
    font-size: 13px; font-weight: 600; color: var(--text-faint);
    text-transform: uppercase; letter-spacing: 0.08em; padding: 16px 4px 12px;
  }
  .match-item {
    display: flex; align-items: center; gap: 14px; padding: 14px;
    background: var(--card-bg); border-radius: 16px; margin-bottom: 8px;
    cursor: pointer; transition: transform 0.12s, background 0.12s;
  }
  .match-item:active { transform: scale(0.97); background: rgba(255,255,255,0.04); }
  .match-avatar {
    width: 56px; height: 56px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; flex-shrink: 0; position: relative;
  }
  .match-avatar::after {
    content: ''; position: absolute; bottom: 2px; right: 2px;
    width: 12px; height: 12px; border-radius: 50%;
    background: var(--like); border: 2.5px solid var(--bg);
  }
  .match-avatar.IDEA { background: var(--idea-gradient); }
  .match-avatar.TODO { background: var(--todo-gradient); }
  .match-avatar.TASK { background: var(--task-gradient); }
  .match-avatar.RESEARCH { background: var(--research-gradient); }
  .match-avatar.MEMORY { background: var(--memory-gradient); }
  .match-avatar.URGENT { background: var(--urgent-gradient); }
  .match-info { flex: 1; min-width: 0; }
  .match-name {
    font-size: 15px; font-weight: 600; margin-bottom: 3px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .match-preview {
    font-size: 12px; color: var(--text-soft);
    display: -webkit-box; -webkit-line-clamp: 1;
    -webkit-box-orient: vertical; overflow: hidden;
  }
  .match-time { font-family: var(--mono); font-size: 10px; color: var(--text-faint); flex-shrink: 0; }
  .match-new-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--gold); flex-shrink: 0; margin-left: 4px; }
  .card-view { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .card-stack {
    flex: 1; position: relative;
    display: flex; align-items: center; justify-content: center;
    padding: 8px 20px; overflow: hidden;
  }
  .card-behind {
    position: absolute; width: calc(100% - 56px); max-width: 360px; height: 80%;
    background: var(--card-bg); border-radius: var(--card-radius);
    opacity: 0.4; transform: scale(0.92) translateY(12px);
  }
  .card {
    width: 100%; max-width: 380px; background: var(--card-bg);
    border-radius: var(--card-radius); overflow: hidden; position: relative;
    touch-action: none; user-select: none; will-change: transform; z-index: 2;
    box-shadow: 0 8px 40px rgba(0,0,0,0.4); max-height: 75vh;
    display: flex; flex-direction: column;
  }
  .card.animating { transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.4s ease; }
  .card-hero { padding: 32px 24px 20px; position: relative; }
  .card-hero-gradient {
    position: absolute; inset: 0; opacity: 0.12;
    border-radius: var(--card-radius) var(--card-radius) 0 0;
  }
  .card-hero-gradient.IDEA { background: var(--idea-gradient); }
  .card-hero-gradient.TODO { background: var(--todo-gradient); }
  .card-hero-gradient.TASK { background: var(--task-gradient); }
  .card-hero-gradient.RESEARCH { background: var(--research-gradient); }
  .card-hero-gradient.MEMORY { background: var(--memory-gradient); }
  .card-hero-gradient.URGENT { background: var(--urgent-gradient); }
  .card-type-row {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 16px; position: relative; z-index: 1;
  }
  .card-type-icon {
    width: 44px; height: 44px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center; font-size: 20px;
  }
  .card-type-icon.IDEA { background: var(--idea-gradient); }
  .card-type-icon.TODO { background: var(--todo-gradient); }
  .card-type-icon.TASK { background: var(--task-gradient); }
  .card-type-icon.RESEARCH { background: var(--research-gradient); }
  .card-type-icon.MEMORY { background: var(--memory-gradient); }
  .card-type-icon.URGENT { background: var(--urgent-gradient); }
  .card-type-label {
    font-size: 13px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.06em; color: var(--text-soft);
  }
  .card-type-date { font-family: var(--mono); font-size: 10px; color: var(--text-faint); margin-left: auto; }
  .card-title {
    font-size: 24px; font-weight: 700; line-height: 1.25;
    position: relative; z-index: 1; letter-spacing: -0.02em;
  }
  .card-body {
    padding: 0 24px 24px; flex: 1; overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  .card-divider { height: 1px; background: rgba(255,255,255,0.06); margin-bottom: 18px; }
  .card-brief { font-size: 13px; line-height: 1.7; color: var(--text-soft); white-space: pre-wrap; }
  .stamp {
    position: absolute; top: 32px; z-index: 10;
    font-size: 36px; font-weight: 800; text-transform: uppercase;
    letter-spacing: 0.04em; padding: 6px 16px;
    border: 4px solid; border-radius: 12px; opacity: 0; pointer-events: none;
  }
  .stamp.nope { right: 24px; color: var(--nope); border-color: var(--nope); transform: rotate(15deg); }
  .stamp.like { left: 24px; color: var(--like); border-color: var(--like); transform: rotate(-15deg); }
  .actions {
    display: flex; justify-content: center; align-items: center;
    gap: 20px; padding: 16px 0 24px; flex-shrink: 0;
  }
  .act-btn {
    border-radius: 50%; border: none;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: transform 0.12s, box-shadow 0.12s;
  }
  .act-btn:active { transform: scale(0.88); }
  .act-btn.small { width: 48px; height: 48px; font-size: 18px; }
  .act-btn.large { width: 64px; height: 64px; font-size: 26px; }
  .act-btn.nope-btn { background: var(--nope-soft); color: var(--nope); box-shadow: 0 4px 20px rgba(255,68,88,0.15); }
  .act-btn.like-btn { background: var(--like-soft); color: var(--like); box-shadow: 0 4px 20px rgba(0,212,138,0.15); }
  .act-btn.star-btn { background: var(--gold-soft); color: var(--gold); }
  .navbar {
    display: flex; justify-content: space-around; align-items: center;
    padding: 10px 0 14px; border-top: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0; background: var(--bg);
  }
  .nav-item {
    display: flex; flex-direction: column; align-items: center; gap: 3px;
    background: none; border: none; cursor: pointer; color: var(--text-faint);
    padding: 4px 16px; transition: color 0.15s;
  }
  .nav-item.active { color: var(--gold); }
  .nav-icon { font-size: 22px; }
  .nav-label { font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; }
  .nav-icon-wrap { position: relative; display: inline-block; }
  .nav-badge {
    position: absolute; top: -4px; right: -8px; min-width: 16px; height: 16px;
    border-radius: 8px; background: var(--nope); color: white;
    font-size: 9px; font-weight: 700; display: flex;
    align-items: center; justify-content: center; padding: 0 4px;
  }
  .empty-state {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center; padding: 40px; text-align: center;
  }
  .empty-owl { font-size: 72px; margin-bottom: 16px; filter: grayscale(0.3); animation: float 4s ease-in-out infinite; }
  @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
  .empty-title { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
  .empty-sub { font-size: 14px; color: var(--text-soft); }
  .toast {
    position: fixed; bottom: 120px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    font-size: 13px; font-weight: 600; padding: 12px 24px; border-radius: 30px;
    opacity: 0; transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    pointer-events: none; z-index: 100;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  .toast.nope-toast { background: var(--nope-soft); color: var(--nope); }
  .toast.like-toast { background: var(--like-soft); color: var(--like); }
  @keyframes cardIn {
    from { opacity: 0; transform: scale(0.9) translateY(20px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }
  .card-enter { animation: cardIn 0.3s cubic-bezier(0.22, 1, 0.36, 1); }
</style>
</head>
<body>
<div class="app" id="app"></div>
<div class="toast" id="toast"></div>
<script>
(function() {
  const APP = document.getElementById('app');
  const TOAST = document.getElementById('toast');
  const SK = 'owl-swipe-decisions';
  const TE = { IDEA:'\u{1F4A1}', TODO:'\u26A1', TASK:'\u26A1', RESEARCH:'\u{1F50D}', MEMORY:'\u{1F9E0}', URGENT:'\u{1F525}' };
  const TN = { IDEA:'Idea', TODO:'To Do', TASK:'Task', RESEARCH:'Research', MEMORY:'Memory', URGENT:'Urgent' };

  let all = [], dec = {}, view = 'matches', ci = 0;

  function ld() { try { dec = JSON.parse(localStorage.getItem(SK)||'{}'); } catch(e) { dec={}; } }
  function sv() { try { localStorage.setItem(SK, JSON.stringify(dec)); } catch(e) {} }
  function pk(p) { return p.date+'|'+p.time+'|'+p.type+'|'+(p.rawContent||p.content).substring(0,30); }
  function q() { return all.filter(p => p.processed && !dec[pk(p)]); }
  function fd(d) { const t=new Date(d+'T00:00:00'); return ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][t.getMonth()]+' '+t.getDate(); }
  function esc(s) { const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }

  function toast(t, txt) {
    TOAST.className='toast '+t; TOAST.textContent=txt;
    TOAST.classList.add('show'); setTimeout(()=>TOAST.classList.remove('show'),1600);
  }
  function decide(p, d) { dec[pk(p)]=d; sv(); toast(d==='archived'?'nope-toast':'like-toast', d==='archived'?'\u2718  Archived':'\u{1F525}  Going deeper'); }

  function render() { const queue=q(); view==='cards'?renderCards(queue):renderMatches(queue); }

  function renderMatches(queue) {
    APP.innerHTML = `
      <div class="header">
        <div class="logo"><span class="logo-icon">\u{1F989}</span><span class="logo-text">Owl</span></div>
        ${queue.length?`<div class="header-badge">${queue.length} new</div>`:''}
      </div>
      ${!queue.length?`
        <div class="empty-state">
          <div class="empty-owl">\u{1F989}</div>
          <div class="empty-title">All caught up</div>
          <div class="empty-sub">Check back after Owl's morning digest</div>
        </div>
      `:`
        <div class="matches-view">
          <div class="section-label">New matches</div>
          ${queue.map((p,i)=>`
            <div class="match-item" data-idx="${i}">
              <div class="match-avatar ${p.type}">${TE[p.type]||'\u{1F4A1}'}</div>
              <div class="match-info">
                <div class="match-name">${esc(p.rawContent||p.content).substring(0,60)}</div>
                <div class="match-preview">${p.processedContent?esc(p.processedContent.substring(0,80)):'Tap to review'}</div>
              </div>
              <div class="match-time">${fd(p.date)}</div>
              <div class="match-new-dot"></div>
            </div>
          `).join('')}
        </div>
      `}
      <div class="navbar">
        <button class="nav-item active">
          <div class="nav-icon-wrap"><span class="nav-icon">\u{1F989}</span>${queue.length?`<span class="nav-badge">${queue.length}</span>`:''}</div>
          <span class="nav-label">Matches</span>
        </button>
        <button class="nav-item" id="navC"><span class="nav-icon">\u{1F0CF}</span><span class="nav-label">Swipe</span></button>
        <button class="nav-item" onclick="window.location.href='./index.html'"><span class="nav-icon">\u{1F4CA}</span><span class="nav-label">Dashboard</span></button>
      </div>`;
    APP.querySelectorAll('.match-item').forEach(el=>el.addEventListener('click',()=>{ci=parseInt(el.dataset.idx);view='cards';render();}));
    const nc=document.getElementById('navC'); if(nc)nc.addEventListener('click',()=>{ci=0;view='cards';render();});
  }

  function renderCards(queue) {
    if(!queue.length||ci>=queue.length){view='matches';ci=0;render();return;}
    const p=queue[ci], hn=ci<queue.length-1;
    APP.innerHTML = `
      <div class="header">
        <div class="logo"><span class="logo-icon">\u{1F989}</span><span class="logo-text">Owl</span></div>
        <div class="header-badge">${ci+1} / ${queue.length}</div>
      </div>
      <div class="card-view">
        <div class="card-stack">
          ${hn?'<div class="card-behind"></div>':''}
          <div class="card card-enter" id="sc">
            <div class="stamp nope" id="sn">Nope</div>
            <div class="stamp like" id="sl">Dig in</div>
            <div class="card-hero">
              <div class="card-hero-gradient ${p.type}"></div>
              <div class="card-type-row">
                <div class="card-type-icon ${p.type}">${TE[p.type]||'\u{1F4A1}'}</div>
                <div class="card-type-label">${TN[p.type]||p.type}</div>
                <div class="card-type-date">${fd(p.date)}${p.time?' \u00b7 '+p.time:''}</div>
              </div>
              <div class="card-title">${esc(p.rawContent||p.content)}</div>
            </div>
            ${p.processedContent?`<div class="card-body"><div class="card-divider"></div><div class="card-brief">${esc(p.processedContent)}</div></div>`:''}
          </div>
        </div>
        <div class="actions">
          <button class="act-btn large nope-btn" id="nb">\u2718</button>
          <button class="act-btn small star-btn" id="sb">\u2605</button>
          <button class="act-btn large like-btn" id="lb">\u{1F525}</button>
        </div>
      </div>
      <div class="navbar">
        <button class="nav-item" id="nm">
          <div class="nav-icon-wrap"><span class="nav-icon">\u{1F989}</span>${queue.length?`<span class="nav-badge">${queue.length}</span>`:''}</div>
          <span class="nav-label">Matches</span>
        </button>
        <button class="nav-item active"><span class="nav-icon">\u{1F0CF}</span><span class="nav-label">Swipe</span></button>
        <button class="nav-item" onclick="window.location.href='./index.html'"><span class="nav-icon">\u{1F4CA}</span><span class="nav-label">Dashboard</span></button>
      </div>`;
    document.getElementById('nm').addEventListener('click',()=>{view='matches';render();});
    document.getElementById('nb').addEventListener('click',()=>swOut('left',p));
    document.getElementById('lb').addEventListener('click',()=>swOut('right',p));
    document.getElementById('sb').addEventListener('click',()=>toast('like-toast','\u2605  Bookmarked'));
    setupTouch(p);
  }

  function swOut(dir, p) {
    const c=document.getElementById('sc'); if(!c)return;
    c.classList.add('animating');
    c.style.transform=`translateX(${dir==='left'?-500:500}px) rotate(${dir==='left'?-20:20}deg)`;
    c.style.opacity='0';
    setTimeout(()=>{decide(p,dir==='left'?'archived':'deeper');render();},350);
  }

  function setupTouch(pel) {
    const c=document.getElementById('sc'), sn=document.getElementById('sn'), sl=document.getElementById('sl');
    if(!c)return;
    let sx=0,cx=0,dr=false,sd=null;
    c.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;dr=true;sd=null;c.style.transition='none';},{passive:true});
    c.addEventListener('touchmove',e=>{
      if(!dr)return;
      cx=e.touches[0].clientX-sx;
      const cy=e.touches[0].clientY-(e.touches[0].clientY);
      if(sd===null)sd=Math.abs(e.touches[0].clientY-sx)>Math.abs(cx)?'y':'x';
      if(sd===null){const ay=Math.abs(e.touches[0].clientY-e.touches[0].clientY);sd=ay>Math.abs(cx)?'y':'x';}
      if(sd==='y')return;
      e.preventDefault();
      c.style.transform=`translateX(${cx}px) rotate(${cx*0.06}deg)`;
      const t=50;
      if(cx<-t){sn.style.opacity=Math.min(1,(Math.abs(cx)-t)/80);sl.style.opacity='0';}
      else if(cx>t){sl.style.opacity=Math.min(1,(cx-t)/80);sn.style.opacity='0';}
      else{sn.style.opacity='0';sl.style.opacity='0';}
    },{passive:false});
    c.addEventListener('touchend',()=>{
      if(!dr||sd==='y'){dr=false;return;}
      dr=false;sn.style.opacity='0';sl.style.opacity='0';
      if(cx<-120)swOut('left',pel);
      else if(cx>120)swOut('right',pel);
      else{c.classList.add('animating');c.style.transform='translateX(0) rotate(0)';}
    });
  }

  function parse(data) {
    return data.map(p=>{
      const c=p.content||'', pm=c.match(/### PROCESSED[\s\S]*/);
      let raw=c,proc=null,done=false;
      if(pm){raw=c.substring(0,pm.index).trim();proc=pm[0].replace(/^### PROCESSED\s*\d{1,2}:\d{2}\s*\n?/,'').replace(/\nStatus:\s*DONE\s*$/,'').trim();done=true;}
      else if(c.includes('Status: DONE')){done=true;proc=c;raw=c.split('\n')[0];}
      return{...p,rawContent:raw,processedContent:proc,processed:done};
    });
  }

  async function init() {
    ld();
    try{const r=await fetch('./pellets.json?t='+Date.now());if(r.ok)all=parse(await r.json());}catch(e){}
    render();
  }
  init();
})();
</script>
</body>
</html>
